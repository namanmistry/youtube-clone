{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Youtube</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="{% static 'video/css/bootstrap.css' %}">

	<link rel="stylesheet" type="text/css" href="{% static 'video/css/all.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'video/css/fontawesome.css' %}"> 
	<link rel="stylesheet" type="text/css" href="{% static 'video/css/style.css' %}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
		 <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/3.0.7/shaka-player.ui.min.js" integrity="sha512-KpD7UW8aOliftdEvclj0KBnwh6vKS708SS41xCNr11yjCSAcYxb4+tlaQTfK+GDw2VCv2DxiM2Zu1d3+WqXw+g==" crossorigin="anonymous"></script>
	 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/3.0.7/controls.min.css" integrity="sha512-XLwXArwaPbtdmlcbaeNgSF3cBB4Q7T7ptfhEfpkDIc/gkvKk8S413yzTByJ7X9dgOZR/T7NxrQI0HE4hlc+2GQ==" crossorigin="anonymous" />
	 <script defer src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
 <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>

</head>
<body>
	<!-- Top navbar -->
	<nav class="container-fluid fixed-top bg-white pt-2" id="top_nav">
		<div class="row">
			<div class="col-4 pl-4">
				<a class="navbar-brand" href="/videos/"><img src="{% static 'video/images/logo.jpg' %}"></a>
			</div>
			<div class="col-4">
				<form method="POST" action="/videos/search/">
					<div class="input-group mb-3">
						<input type="text" class="form-control search" name="searchtext" placeholder="Search">
						<div class="input-group-append">
							<button class="btn btn-outline-secondary" data-toggle="tooltip" data-placement="bottom" title="Search!"><i class="fas fa-search"></i></button>
						</div>
					</div>
				</form>
			</div>
			<div class="col-4 text-right">
				<a href="/users/login-user/" class="btn btn-outline-primary"><i class="fas fa-user-circle" style="font-size: 20px;"></i> <span style="font-size:14px; font-weight: 600;">SIGN IN</span></a>
			</div>
		</div>
	</nav>
	<!-- Top navbar -->

	<!-- mobile top navbar -->
	<nav class="container-fluid fixed-top bg-white pt-3" id="top_nav_mobile">
		<div class="row">
			<div class="col-3 pl-4">
				<a class="navbar-brand" href="index.html"><img src="images/logo.jpg" class="mb-2"></a>
			</div>
			<div class="col-7">
				<form>
					<div class="input-group mb-3">
						<input type="text" class="form-control search" placeholder="Search">
						<div class="input-group-append">
							<button class="btn btn-outline-secondary" data-toggle="tooltip" data-placement="bottom" title="Search!"><i class="fas fa-search"></i></button>
						</div>
					</div>
				</form>
			</div>
			<div class="col-2 text-right">
				<a href="login.html"><i class="fas fa-user-circle" style="font-size: 30px;"></i></a>
			</div>
		</div>
	</nav>
	<!-- mobile top navbar -->

<!-- sidebar -->
 <nav class="main-nav desc_hide">
      <ul>
        <li class="">
          <a href="index.html">
          	<span class="fa fa-2x">
	            <svg style="display: block; height: 24px; width: 24px;margin: auto;" viewBox="0 0 24 24">
				   <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8" fill="red"></path>
				</svg>
			</span>
            <span class="nav-text">
                Home
            </span>
          </a>
        </li>

        <li class="has-subnav">
          <a href="trending.html">
          	<span class="fa fa-2x">
	            <svg style="display: block; height: 24px; width: 24px;margin: auto;" viewBox="0 0 24 24">
				  <path d="M17.53 11.2c-.23-.3-.5-.56-.76-.82-.65-.6-1.4-1.03-2.03-1.66-1.46-1.46-1.78-3.87-.85-5.72-.9.23-1.75.75-2.45 1.32C8.9 6.4 7.9 10.07 9.1 13.22c.04.1.08.2.08.33 0 .22-.15.42-.35.5-.22.1-.46.04-.64-.12-.06-.05-.1-.1-.15-.17-1.1-1.43-1.28-3.48-.53-5.12C5.87 10 5 12.3 5.12 14.47c.04.5.1 1 .27 1.5.14.6.4 1.2.72 1.73 1.04 1.73 2.87 2.97 4.84 3.22 2.1.27 4.35-.12 5.96-1.6 1.8-1.66 2.45-4.3 1.5-6.6l-.13-.26c-.2-.45-.47-.87-.78-1.25zm-3.1 6.3c-.28.24-.73.5-1.08.6-1.1.38-2.2-.16-2.88-.82 1.2-.28 1.9-1.16 2.1-2.05.17-.8-.14-1.46-.27-2.23-.12-.74-.1-1.37.2-2.06.15.38.35.76.58 1.06.76 1 1.95 1.44 2.2 2.8.04.14.06.28.06.43.03.82-.32 1.72-.92 2.26z" fill="#606060"></path>
				</svg>
			</span>
            <span class="nav-text">
           	  Trending
            </span>
          </a>
        </li>

        <li class="has-subnav mb-2">
          <a href="subscription.html">
           <span class="fa fa-2x">
	            <svg style="display: block; height: 24px; width: 24px;margin: auto;" viewBox="0 0 24 24">
				  <path d="M18.7 8.7H5.3V7h13.4v1.7zm-1.7-5H7v1.6h10V3.7zm3.3 8.3v6.7c0 1-.7 1.6-1.6 1.6H5.3c-1 0-1.6-.7-1.6-1.6V12c0-1 .7-1.7 1.6-1.7h13.4c1 0 1.6.8 1.6 1.7zm-5 3.3l-5-2.7V18l5-2.7z" fill="#606060"></path>
				</svg>
			</span>
            <span class="nav-text">
             Subscription
            </span>
          </a>
        </li>

        <li class="has-subnav border-top">
          <a href="library.html">
             <span class="fa fa-2x">
	            <svg style="display: block; height: 24px; width: 24px;margin: auto;" viewBox="0 0 24 24">
				  <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" fill="#606060"></path>
				</svg>
			</span>
            <span class="nav-text">
              Library
            </span>
          </a>
        </li>
        <li class="has-subnav">
          <a href="history.html">
             <span class="fa fa-2x">
	            <svg style="display: block; height: 24px; width: 24px;margin: auto;" viewBox="0 0 24 24">
				 <path d="M11.9 3.75c-4.55 0-8.23 3.7-8.23 8.25H.92l3.57 3.57.04.13 3.7-3.7H5.5c0-3.54 2.87-6.42 6.42-6.42 3.54 0 6.4 2.88 6.4 6.42s-2.86 6.42-6.4 6.42c-1.78 0-3.38-.73-4.54-1.9l-1.3 1.3c1.5 1.5 3.55 2.43 5.83 2.43 4.58 0 8.28-3.7 8.28-8.25 0-4.56-3.7-8.25-8.26-8.25zM11 8.33v4.6l3.92 2.3.66-1.1-3.2-1.9v-3.9H11z" fill="#606060"></path>
				</svg>
			</span>
            <span class="nav-text">
                History
            </span>
          </a>
        </li>
      </ul>
    </nav>
<!-- sidebar -->
	

	<!-- main content -->
	<div class="container-fluid watch_video">
		<div class="row pt-4">
			<div class="col-md-8 video_box">
				<div data-shaka-player-container style=" width:975px; height:540px"
         			data-shaka-player-cast-receiver-id="930DEB06">
      			<video autoplay data-shaka-player id="video" src="/media/{{video.id}}/{{video.id}}.mpd" ></video>
    			</div>
				<div class="p-1 pt-3">
					<div class="title">{{video.title}}</div>
					<div class="row mt-2 border-bottom">
						<div class="col-7">
							<div style="color:#606060;">{{video.views}} views â€¢ {{video.datePosted}}</div>
						</div>
						<div class="col-5 text-right">
							<div class="row">
								<div class="col-3 border-bottom border-dark">
									<a id="like" href="#" style="color:#606060;" title="I like this">
									<svg style="height: 18px; width: 18px;margin: auto;" viewBox="0 0 24 24">
									  <path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z"  fill="#606060"></path>
									</svg> <p id="likes">{{video.likes}}</p>
									</a>
								</div>
								<div class="col-3 border-bottom border-dark">
									<a id="dislike" href="#" style="color:#606060;" title="I dislike this">
										<svg style="height: 18px; width: 18px;margin: auto;" viewBox="0 0 24 24">
									  <path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v1.91l.01.01L1 14c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z" fill="#606060"></path></svg> 
									  <p id="dislikes">{{video.dislikes}}</p>
									</a>
								</div>
								<div class="col-3">
									<a id="share" href="#" style="color:#606060;" title="Share">
										<svg style="height: 18px; width: 18px;margin: auto;" viewBox="0 0 24 24">
									  <path d="M11.7333 8.26667V4L19.2 11.4667L11.7333 18.9333V14.56C6.4 14.56 2.66667 16.2667 0 20C1.06667 14.6667 4.26667 9.33333 11.7333 8.26667Z" fill="#606060"></path></svg> SHARE
									</a>
								</div>
								<div class="col-3">
									<a id="save" href="#" style="color:#606060;" title="Save">
										<svg style="height: 18px; width: 18px;margin: auto;" viewBox="0 0 24 24">
									 <path d="M14 10H2v2h12v-2zm0-4H2v2h12V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM2 16h8v-2H2v2z"  fill="#606060"></path></svg> SAVE
									</a>
								</div>
							</div>
						</div>
					</div>
					<div class="row mt-4 border-bottom ">
						<div class="col-1 pr-0 w-2 text-right">
							<img id="img" width="48" height="48"  src="{{video.channel.image.url}}" class="rounded-circle">
						</div>
						<div class="col-9 pl-0">
							<p style="color:#303030;">
								<b>{{video.channel.name}}</b> <i class="fas fa-check-circle"></i><br>
								<span id="subscribers" style="color:#606060">
								{% if video.channel.subscribers == 1  %}
								{{video.channel.subscribers}} subscriber
								{% endif %}
								{% if video.channel.subscribers != 1  %}
								{{video.channel.subscribers}} subscribers
								{% endif %}
								</span>
							</p>
							<p>{{video.description1}}<span id="dots">...</span>
							<span id="more">{{video.description2}}</span>
							</p>
							<button onclick="myFunction()" id="myBtn" class="btn">SHOW MORE</button>
						</div>
						<div class="col-2 text-right">
							<button id="subscribe" class="btn btn-danger">SUBSCRIBE</button>
						</div>

					</div>
					<div class="row mb-4">
						<div id="numberOfComments" class="col-12 m-4" style="color: #303030; font-weight: bold">
						{% if numberOfComments == 1 %}
						{{numberOfComments}} Comment</div>
						{% endif %}
						{% if numberOfComments != 1 %}
						{{numberOfComments}} Comments</div>
						{% endif %}
				
						<div class="col-11">
							<form  id="commentform">
								<input id="comment" type="text" name="comment" class="input_comment" placeholder="Add a public comment...">
								<input type="submit" value="post" id="postcomment">
							</form>
						</div>
						<div id="comments" class="col-11">
							{% for comment in comments %}
							<div class="mt-5">
							<b>{{comment.Account.firstName}}</b><br>
							{{comment.description}}</div>
							
							<hr><br>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-4">
			{% for video in allvideos %}
				<div class="container-fluid video_list">
					<a href="/videos/watch/{{video.id}}/">
						<div class="card">
							<div class="row p-0">
								<div class="col-md-5">
									<img class="video_list_responsive" src="{{video.thumbnail.url}}" alt="image" width="100%" height="94" />
								</div>
								<div class="col-md-7 p-0">
										<p class="mb-1 title" title="{{video.title}}">{{video.title}}</p>
											<p style="color:#606060;">
												{{video.channel.name}} <i class="fas fa-check-circle"></i> <br>
												{{video.views}} views 
											</p>
								</div>
							</div>
						</a>
					</div>
				</div>
			{% endfor %}
			</div>
		</div>
	</div>
	<p id="id" hidden>{{video.id}}</p>
	<p id="channelId" hidden>{{video.channel.id}}</p>
	
		<!-- main content -->

		<script src="{% static 'video/js/jquery-3.5.1.min.js' %}"></script>
		<script src="{% static 'video/js/popper.min.js' %}"></script>
		<script src="{% static 'video/js/bootstrap.min.js' %}"></script>

		<script>
			$(document).ready(function(){
				$('[data-toggle="tooltip"]').tooltip();   
			});

function myFunction() {
  var dots = document.getElementById("dots");
  var moreText = document.getElementById("more");
  var btnText = document.getElementById("myBtn");

  if (dots.style.display === "none") {
    dots.style.display = "inline";
    btnText.innerHTML = "SHOW MORE"; 
    moreText.style.display = "none";
  } else {
    dots.style.display = "none";
    btnText.innerHTML = "SHOW LESS"; 
    moreText.style.display = "inline";
  }
}

//My custom javascript
likebutton = document.getElementById('like')
likebutton.addEventListener('click',sendLike)
video_id = document.getElementById('id').innerHTML

function sendLike(e){
	e.preventDefault();
	var x = new XMLHttpRequest();
	x.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("likes").innerHTML =
      this.responseText;
    }
	};
	x.open("POST", `/videos/like/${video_id}/`, true);
	x.send();
}

dislikebutton = document.getElementById('dislike')
dislikebutton.addEventListener('click',sendDisLike)


function sendDisLike(e){
	e.preventDefault();
	var x = new XMLHttpRequest();
	x.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("dislikes").innerHTML =
      this.responseText;
    }
	};
	x.open("POST", `/videos/dislike/${video_id}/`, true);
	x.send();
}

sharebutton = document.getElementById('share')
sharebutton.addEventListener('click',copyToClipboard)
function copyToClipboard (e) {
	e.preventDefault();
	const el = document.createElement('textarea');
  str = window.location.href
  el.value = str;
  document.body.appendChild(el);
  el.select();
  document.execCommand('copy');
  document.body.removeChild(el);
  alert("Link copied to clipboard")
};

savebutton = document.getElementById('save')
savebutton.addEventListener('click',sendsave)
function sendsave (e) {
	e.preventDefault();
	var x = new XMLHttpRequest();
	x.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      alert(this.responseText)
    }
	};
	x.open("POST", `/videos/save/${video_id}/`, true);
	x.send();
};

postcomment = document.getElementById('postcomment')
postcomment.addEventListener('click',sendcomment)
function sendcomment (e) {
	value = document.getElementById('comment').value
	e.preventDefault();
	var x = new XMLHttpRequest();
	x.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      comments = document.getElementById('comments')
	  data = JSON.parse(this.responseText)
	  var div = document.createElement('div');
	  var hr = document.createElement('hr');
	  var br = document.createElement('br');
    	div.id = 'container';
    	div.innerHTML = `<b>${data.name}</b><br>
							${data.description}`;
    	div.className = 'mt-5';
	  comments.append(div)
	  comments.append(hr)
	  comments.append(br)
	  document.getElementById('commentform').reset();
	  document.getElementById('numberOfComments').innerHTML =` ${data.numberOfComments} comments `
    }
	};
	x.open("POST", `/videos/comment/${video_id}/`, true);
	x.send(JSON.stringify({'data':value}));
};

subscribe = document.getElementById('subscribe')
subscribe.addEventListener('click',sendsubscribe)
channelId = document.getElementById('channelId').innerHTML
function sendsubscribe (e) {
	e.preventDefault();
	var x = new XMLHttpRequest();
	x.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById('subscribers').innerHTML= `${this.responseText} Subscribers` 
    }
	};
	x.open("POST", `/videos/subscribe/${channelId}/`, true);
	x.send();
};
</script>
	</body>
	</html>